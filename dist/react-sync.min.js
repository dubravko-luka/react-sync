!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("react"),require("jquery")):"function"==typeof define&&define.amd?define(["react","jquery"],e):"object"==typeof exports?exports.ReactSync=e(require("react"),require("jquery")):t.ReactSync=e(t.react,t.jquery)}(this,function(t,e){return function(t){function e(s){if(r[s])return r[s].exports;var o=r[s]={exports:{},id:s,loaded:!1};return t[s].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){"use strict";var s=r(1),o=r(2),n=s.PropTypes;t.exports=s.createClass({displayName:"React Sync",propTypes:{rootUrl:n.string.isRequired,id:n.oneOfType([n.string,n.number]),fetchOnMount:n.bool,fetchOnNewProps:n.bool,params:n.object,traditionalParams:n.bool,count:n.number,countParam:n.string,start:n.number,startParam:n.string,sorts:n.arrayOf(n.shape({attribute:n.string.isRequired,desc:n.bool.isRequired})),sortInfoSeparator:n.string,sortParam:n.string,onCreate:n.func,onRead:n.func,onUpdate:n.func,onDelete:n.func,onError:n.func,ajaxOptions:n.object},getDefaultProps:function(){return{fetchOnMount:!0,fetchOnNewProps:!0,params:null,traditionalParams:!0,sorts:null,sortInfoSeparator:"|",sortParam:"sort",start:null,startParam:"start",count:null,countParam:"count",onCreate:null,onRead:null,onUpdate:null,onDelete:null,onError:null,ajaxOptions:null}},getInitialState:function(){return{data:null,fetched:!1,loading:!1}},getParameterObject:function(){var t=o.extend({},this.props.params);if(null!==this.props.start&&null!==this.props.count&&(t[this.props.startParam]=this.props.start,t[this.props.countParam]=this.props.count),null!==this.props.sorts&&this.props.sorts.length>0){var e=this.props.sortInfoSeparator;t[this.props.sortParam]=o.map(this.props.sorts,function(t){return(t.desc?"D":"A")+e+t.attribute})}return t},getUrl:function(t){var e=this.props.rootUrl;return null!==this.props.id&&("/"===e[e.length-1]?e+=this.props.id:e=e+"/"+this.props.id),t&&(e=e+"?"+o.param(this.getParameterObject(),this.props.traditionalParams)),e},setLoading:function(t,e){this.isMounted()&&this.setState({loading:t},e)},fetch:function(){this.setLoading(!0,function(){o.ajax(o.extend({},this.props.ajaxOptions,{url:this.getUrl(!0),context:this,success:function(t,e,r){this.setLoading(!1),this.markFetched(),this.setData(t),null!==this.props.onRead&&this.props.onRead.apply(this,arguments)},error:function(t,e,r){this.setLoading(!1),this.clearData(),null!==this.props.onError&&this.props.onError.apply(this,arguments)}}))})},clearData:function(){this.setData(null)},setData:function(t){this.isMounted()&&this.setState({data:t})},markFetched:function(){this.isMounted()&&(this.state.fetched||this.setState({fetched:!0}))},componentDidMount:function(){this.props.fetchOnMount&&this.fetch()},componentWillReceiveProps:function(t){this.props.fetchOnNewProps&&this.fetch()},doSave:function(t){var e=null===this.props.id;this.setLoading(!0,function(){o.ajax(o.extend({},this.props.ajaxOptions,{method:e?"POST":"PUT",data:t,url:this.getUrl(),context:this,success:function(t,r,s){this.setLoading(!1),this.clearData();var o=e?this.props.onCreate:this.props.onUpdate;null!==o&&o.apply(this,arguments)},error:function(t,e,r){this.setLoading(!1),null!==this.props.onError&&this.props.onError.apply(this,arguments)}}))})},doDelete:function(){this.setLoading(!0,function(){o.ajax(o.extend({},this.props.ajaxOptions,{method:"DELETE",url:this.getUrl(),context:this,success:function(t,e,r){this.setLoading(!1),this.clearData(),null!==this.props.onDelete&&this.props.onDelete.apply(this,arguments)},error:function(t,e,r){this.setLoading(!1),null!==this.props.onError&&this.props.onError.apply(this,arguments)}}))})},render:function(){return s.cloneElement(s.Children.only(this.props.children),{data:this.state.data,fetched:this.state.fetched,loading:this.state.loading,onSave:this.doSave,onDelete:this.doDelete})}})},function(e,r){e.exports=t},function(t,r){t.exports=e}])});